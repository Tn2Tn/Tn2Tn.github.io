const podcastData = [
    /** empty data entry
    {
      posterUrl: "",
      title: "",
      guest: "",
      episode: "",
      summary: "",
      podcastPath: "",
      live:false,
    },
    
    */
{
  posterUrl: "assets/images/World-tour.png",
  title: "World Tour",
  guest: "مُحَمَّد רגב Françwa Володимир Mendle..",
  date: "April 7th 2025",
  summary: "Around the world with all diferent expirences. חַג כָּשֵׁר וְשָׂמֵחַ",
  podcastPath: "https://my.microsoftpersonalcontent.com/personal/e424e196fc5855e9/_layouts/15/download.aspx?UniqueId=780f3f9b-8603-4dd6-91c0-7f58a1ed03f0&Translate=false&tempauth=v1e.eyJzaXRlaWQiOiJiMDk2ZDcwMS1mODA5LTRiZTgtODkyYi1lOTNjZmY2NjQ4NmMiLCJhcHBpZCI6IjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDA0ODE3MTBhNCIsImF1ZCI6IjAwMDAwMDAzLTAwMDAtMGZmMS1jZTAwLTAwMDAwMDAwMDAwMC9teS5taWNyb3NvZnRwZXJzb25hbGNvbnRlbnQuY29tQDkxODgwNDBkLTZjNjctNGM1Yi1iMTEyLTM2YTMwNGI2NmRhZCIsImV4cCI6IjE3NDQwNTc4MjQifQ.0vrUnwegY4qKEDvxs6ixNbFxq47SOnUeQpEXM-Js8y6IzokmDRKFlAK_csY6iPTpu26txxmOfa1KU0COL-gmjb28HtzwlxxknUjNnYXqW42ZjV8DSZsyfOfinPbe8IQ-kbUXsOZf-8Hv0VW6v0DpCudYlfz6siP69QZShzxTO1NVETCQOFUNI09IkqR_BzoFDWOWQ-80KusIe7pYyrNdCZmx29gn8hm7xw_hHQZZaZdBi4WRITGdiCjrcTafTYYUk_30NHn4kqq86HonGjiwsWRTOCAe4Vgjq4-fE8p88Z1D9HoYXdL2D-lqxakHNQe7K7i0irrEUriJheRY1NeDIUYdJK5j9x-4KqHr70gsScg_f_UGv2srMc4rWyuc15UVsadlqN7rw8ZqBgFsFcrcXw.L6ypwGfDyrFustfqtjePou74o7EB79nvdpC4HoBSgsY&ApiVersion=2.0",
},
{
  posterUrl: "assets/images/Purim25.png",
  title: "Cowen again",
  guest: "Ahron Cowen",
  date: "Purim",
  summary: "",
  podcastPath: "assets/audio/Venohapochu.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode10.png",
  title: "Wheres Wally",
  guest: "Yehoshua Sayagh",
  date: "November 7th 2024",
  summary: "Thank You Hashem Ep. 10 Is Out. Discussing where Yehoshua works, Jtrade and freebees' & why this podcast's Episodes aren't more than 45min (around)",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Yehoshua Sayagh.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode09.png",
  title: "Cholent Of Topics",
  guest: "Shmuli Stimler & Lael Tam",
  date: "September 22nd 2024",
  summary: "I don't even know how to describe this comedy sketch (dont worry its not all funny)",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Shmuli Stimler & Lael Tam.mp3",
  images: "https://tn2tn.github.io/podcast/assets/images/podcast 9/",
  imagesNum: 2,
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode08.png",
  title: "Simcha Dynamics",
  guest: "Eli Netzer",
  date: "July 12th 2024",
  summary: "listen to us discuss the funny things that happen in simchas and kiddushim across the board.",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Eli Netser.mp3",
  images: "https://tn2tn.github.io/podcast/assets/images/podcast 8/",
  imagesNum: 1,
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode07.png",
  title: "Travel and more",
  guest: "Ari Hirsch & Gershy Bambeger",
  date: "June 20th 2024",
  summary: "Ari's child like obsession with stuffed animals, jet setting and gershy bamberger clapping when compleatly needed",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Ari Hirsch & Gershy Bambeger.mp3",
  images: "https://tn2tn.github.io/podcast/assets/images/podcast 7/",
  imagesNum: 5,
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode06.png",
  title: "Inspiration with Chaim Morgan",
  guest: "Chaim Morgan",
  date: "May 10th 2024",
  summary: "Keep calm and listen to Chaim Morgan who joined us to discuss his inspiring thoughts on the world and give so much inspiration to the nation. (This Podcast Is Serious)",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Chaim Morgan.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode05.png",
  title: "Therapy Problems (Solved)",
  guest: "Nosson Perl & Ari Gutwirth",
  date: "April 18th 2024",
  summary: "Just sit and listen to Nosson Perl discuss the problems of therapy, find a solution for it theoretically and Shmuze about who knows what.",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Nosson_Perl_&_Ari_Gutwirth.mp3",
  images: "https://tn2tn.github.io/podcast/assets/images/podcast 5/",
  imagesNum: 3,
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode04.png",
  title: "Jaaayson For The Naaation",
  guest: "Binyomin Jayson & Yehuda Stone",
  date: "April 11th 2024",
  summary: "Listen to Binyomin Jayson speak about politics and who knows what, sing (like a Chazon) and give shout outs to everyone who lives on earth well almost. Keep an ear out for Yehuda Stones short words every now and then.",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Stone_&_Jayson.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode03.png",
  title: "Chassidish Wikipedia",
  guest: "Ahron Cowen",
  date: "April 4th 2024",
  summary: "Listen to Ahron Cowen speak about chassidim sharing a small percentage of his large knowledge about them. Litvaks Don't Have To Agree.",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Ahron Cowen.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode02.png",
  title: "Daily Quota",
  guest: "Shloimy Blun & Surprise Guest",
  date: "March 7th 2024",
  summary: "An interview with Shloimy Blum discussing his daily Quote, many jokes, his revolution and controversial debates. (07565954248)x∞  P.S. NOT ALL RESPONSES ARE ENDORSED BY MECHANCHIM",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Sloimy Blun & surprise.mp3",
},
{
  posterUrl: "https://tn2tn.github.io/podcast/assets/images/episode01.png",
  title: "Baal Musar",
  guest: "Eliezer Kahn",
  date: "March 1st 2024",
  summary: "Listen to Eliezer give life musar to all listeners under 90 years young and list 16/21 nicknames. Thank you to MGS for making this episode come out late",
  podcastPath: "https://tn2tn.github.io/podcast/assets/audio/Eliezer Podcast.mp3",
}
  ];
  
  // Global variables for tracking current podcast
  let currentMusic = 0;
  let lastPlayedMusic = 0;
  let audioSource;
  
  //playlist porgress
  function updatePlaylistProgress(index, percentagePlayed) {
  const playlistItems = document.querySelectorAll('[data-playlist-item]');
  
  if (index >= 0 && index < playlistItems.length) {
    const item = playlistItems[index];
    const completeBar = item.querySelector('.complete');
    
    if (completeBar) {
      // Adjust width between 50% (0% played) and 150% (100% played)
      // Clamp the percentage between 0 and 100
      const clampedPercentage = Math.min(Math.max(percentagePlayed, 0), 100);
      completeBar.style.width = `${50 + (clampedPercentage)}%`;
    }
  }
}
  
// Function to update playlist progress based on stored cookies
function updatePlaylistProgressFromCookies() {
  const playlistItems = document.querySelectorAll('[data-playlist-item]');
  
  playlistItems.forEach((item, index) => {
    const podcast = podcastData[index];
    const cookieName = `podcast_progress_${encodeURIComponent(podcast.date.replace(/\s+/g, '_'))}`;
    
    // Find the cookie
    const cookies = document.cookie.split('; ');
    const progressCookie = cookies.find(row => row.startsWith(`${cookieName}=`));
    
    const completeBar = item.querySelector('.complete');
    
    if (progressCookie && completeBar) {
      try {
        const progressData = JSON.parse(progressCookie.split('=')[1]);
        
        // Ensure the podcast path matches to prevent loading progress for a different podcast
        if (progressData.podcastPath === podcast.podcastPath) {
          // Clamp the percentage between 0 and 100
          const clampedPercentage = Math.min(Math.max(progressData.percentagePlayed, 0), 100);
          
          // Adjust width between 50% (0% played) and 150% (100% played)
          completeBar.style.width = `${50 + (clampedPercentage)}%`;
        } else {
          // If podcast path doesn't match, reset to 0%
          completeBar.style.width = '50%';
        }
      } catch (error) {
        // If there's an error parsing the cookie, reset to 0%
        completeBar.style.width = '50%';
      }
    } else {
      // No cookie found, reset to 0%
      completeBar.style.width = '50%';
    }
  });
}


// Modify the existing createVideoGallery function to ensure the complete bar exists
function createVideoGallery() {
  const gallery = document.getElementById("videoGallery");
  gallery.innerHTML = ''; // Clear existing content

  podcastData.forEach((podcast, index) => {
    const thumbnail = podcast.posterUrl 
      ? podcast.posterUrl 
      : `https://via.placeholder.com/150/000000/FFFFFF?text=${encodeURIComponent(podcast.title)}`;

    const videoItem = document.createElement("button");
    videoItem.className = "video-item";
    videoItem.setAttribute('data-playlist-item', index);

    videoItem.innerHTML = `
      <img class="thumbnail" src="${thumbnail}" alt="${podcast.title}">
      <div class="video-overlay">
        <h3 class="video-title">${podcast.title}</h3>
        <span class="video-org">${podcast.guest}</span>
        <span class="video-date">${podcast.date}</span>
        <div class="play-icon-container">
          <svg class="play-ring-dot" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">
            <path d="M34.8942 0.24557C27.4765 1.2172 20.5608 4.18067 14.8112 8.84448C13.224 10.1238 10.1954 13.1196 8.93208 14.658C4.21905 20.4068 1.17421 27.5645 0.218646 35.1432C-0.0728819 37.5237 -0.0728819 42.479 0.218646 44.8595C0.704525 48.7622 1.69248 52.3734 3.26349 56.0332C7.11813 65.0531 14.9408 72.8585 23.9943 76.7451C29.258 79.0122 34.1492 80 39.9959 80C44.7414 80 48.2073 79.4494 52.5802 78.0244C56.2243 76.826 61.488 74.1702 62.3464 73.0853C62.5731 72.7938 62.6703 72.4213 62.6703 71.8707C62.6703 71.1744 62.6055 70.9963 62.1196 70.5104C61.65 70.0408 61.4556 69.9599 60.8078 69.9599C60.1761 69.9599 60.1761 69.9599 59.836 70.0894C54.8153 73.2634 49.4382 75.1419 44.2069 75.7896C41.9071 76.0649 37.2912 76.0001 34.8456 75.6277C21.8079 73.7168 10.827 64.8588 6.22735 52.5677C3.71698 45.8473 3.32827 37.8638 5.15842 30.8842C8.39761 18.4798 18.1152 8.66635 30.5213 5.26565C34.0682 4.29402 36.692 4.00253 40.8867 4.0997C44.6442 4.18067 46.361 4.40738 49.503 5.26565C56.3539 7.11174 62.978 11.3545 67.5453 16.828C71.8858 22.01 74.6553 28.1961 75.6271 34.8517C75.9996 37.297 76.0644 41.9122 75.789 44.2117C75.1412 49.4423 73.2625 54.8187 70.6225 58.9805C70.0881 59.8387 69.9585 60.1788 69.9585 60.8104C69.9585 61.4581 70.0395 61.6524 70.5092 62.1221C70.9788 62.5917 71.1732 62.6726 71.8534 62.6726C72.3231 62.6726 72.7928 62.5593 73.0195 62.4135C74.0075 61.7172 76.7932 56.3409 77.9431 52.8592C79.3846 48.5031 80 44.7137 80 40.0337C80 34.1554 79.012 29.281 76.7446 24.0019C73.3273 16.0183 67.0918 9.21694 59.1558 4.77984C56.2243 3.14426 51.6894 1.47631 48.1263 0.73139C44.6442 0.00266916 38.4897 -0.224047 34.8942 0.24557Z" fill="white" />
            <path d="M66.42 64.8904C65.9179 64.9876 64.9947 65.943 64.8975 66.4774C64.606 67.9349 65.9179 69.2304 67.3269 68.9065C67.9748 68.7769 68.817 67.8701 68.9141 67.1737C69.1409 65.8135 67.8452 64.6313 66.42 64.8904Z" fill="white" />
          </svg>
          <img class="play-button" src="https://img.icons8.com/sf-regular-filled/512/FFFFFF/circled-chevron-right.png" alt="Go">
        </div>
        <div class="readylistened">
          <div class="complete"></div>
          <div>
        </div>
      </div>
    `;
  
      // Add click event to change current podcast
      videoItem.addEventListener("click", function() {
        lastPlayedMusic = currentMusic;
        currentMusic = index;
        
        // Change player info and playlist item
        changePlayerInfo();
        updatePlaylistItem();
      });
  
      gallery.appendChild(videoItem);
    });
  }
  
  // Function to update playlist item
  function updatePlaylistItem() {
    const playlistItems = document.querySelectorAll('[data-playlist-item]');
    playlistItems.forEach((item, index) => {
      if (index === lastPlayedMusic) {
        item.classList.remove('playing');
      }
      if (index === currentMusic) {
        item.classList.add('playing');
      }
    });
  }
  
  // Function to change player info
  function changePlayerInfo() {
    const playerBanner = document.querySelector('[data-player-banner]');
    const playerTitle = document.querySelector('[data-title]');
    const playerAlbum = document.querySelector('[data-guest]');
    const playerArtist = document.querySelector('[data-summary]');
    const images = document.querySelector('[data-image-list]');
  
    const currentPodcast = podcastData[currentMusic];
  
    // Update player information
    playerBanner.src = currentPodcast.posterUrl;
    playerBanner.setAttribute('alt', `${currentPodcast.title} Album Poster`);
    playerTitle.textContent = currentPodcast.title;
    playerAlbum.textContent = currentPodcast.guest;
    playerArtist.textContent = currentPodcast.summary;
  
    // Update audio source
    audioSource.src = currentPodcast.podcastPath;
    audioSource.load(); // Reload the audio source
  
    // Populate image gallery (if applicable)
    updateImageGallery(currentPodcast);
  
    // Play the music
    playMusic();
  }
  

  // Function to update image gallery
  function updateImageGallery(currentPodcast) {
    const images = document.querySelector('[data-image-list]');
    images.innerHTML = ''; // Clear existing images
  
    if (currentPodcast.images && currentPodcast.imagesNum) {
      for (let i = 0; i < currentPodcast.imagesNum; i++) {
        const imageURL = `${currentPodcast.images}${i + 1}.jpg`;
        const videoURL = `${currentPodcast.images}${i + 1}.mp4`;
  
        // Check image file
        fetch(imageURL)
          .then((response) => {
            if (response.ok) {
              images.innerHTML += `
                <li>
                  <a href="${imageURL}" data-fancybox="gallery">
                    <img class="image-item" src="${imageURL}" alt="${currentPodcast.title} Image ${i + 1}">
                  </a>
                </li>
              `;
            }
          });
  
        // Check video file
        fetch(videoURL)
          .then((response) => {
            if (response.ok) {
              images.innerHTML += `
                <li>
                  <a href="${videoURL}" data-fancybox="gallery">
                    <video class="image-item" src="${videoURL}" alt="${currentPodcast.title} Image ${i + 1}"></video>
                  </a>
                </li>
              `;
            }
          });
      }
    }
  }
  

  
  // Initialize the page
document.addEventListener('DOMContentLoaded', () => {
    // Initialize audio source
    audioSource = new Audio(podcastData[currentMusic].podcastPath);

    // Create video gallery
    createVideoGallery();

    // Initial player info setup
    const playerBanner = document.querySelector('[data-player-banner]');
    const playerTitle = document.querySelector('[data-title]');
    const playerAlbum = document.querySelector('[data-guest]');
    const playerArtist = document.querySelector('[data-summary]');
    const images = document.querySelector('[data-image-list]');

    const currentPodcast = podcastData[currentMusic];

    // Update player information as if first podcast was clicked
    playerBanner.src = currentPodcast.posterUrl;
    playerBanner.setAttribute('alt', `${currentPodcast.title} Album Poster`);
    playerTitle.textContent = currentPodcast.title;
    playerAlbum.textContent = currentPodcast.guest;
    playerArtist.textContent = currentPodcast.summary;

    // Update playlist item to show first item as selected
    updatePlaylistItem();

    // Populate image gallery (if applicable)
    updateImageGallery(currentPodcast);

    // Update playlist progress from cookies
    updatePlaylistProgressFromCookies();

    // Ensure audio is loaded but not automatically played
    audioSource.load();
});
  
  const islive = function () {
    // Get the current podcast from podcastData array
    // Get the current podcast from podcastData array
    var currentPodcast = podcastData[currentMusic];
  
    // Get all elements with the id "live-hide"
    var liveHideElements = document.querySelectorAll("#live-hide, #download-btn");
    var liveShowElements = document.querySelectorAll("#live-show");
  
    // Check if the current podcast is live
    if (currentPodcast.live) {
      // Loop through each element and hide it
      liveHideElements.forEach(function (element) {
        element.style.display = "none";
      });
      liveShowElements.forEach(function (element) {
        element.style.display = "grid"; // or 'inline', 'flex', etc. depending on the original display value
      });
    } else {
      // Loop through each element and show it
      liveHideElements.forEach(function (element) {
        element.style.display = "grid"; // or 'inline', 'flex', etc. depending on the original display value
      });
      liveShowElements.forEach(function (element) {
        element.style.display = "none";
      });
    }
  };
  islive();
  
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("toggleBtn");
    const galleryContainer = document.getElementById("galleryContainer");
    // Only proceed if both elements exist
    if (!toggleBtn || !galleryContainer) {
        console.warn("Gallery toggle elements not found. Skipping gallery toggle setup.");
        return;
    }
    const closeGallery = () => {
        galleryContainer.style.left = "calc(-93% - 30px)";
        toggleBtn.classList.remove("close");
        
        // Safely update text content
        const iconElement = toggleBtn.querySelector(".material-icons");
        if (iconElement) {
            iconElement.textContent = "open_menu";
        }
    };
    const openGallery = () => {
        galleryContainer.style.left = "0";
        toggleBtn.classList.add("close");
        
        // Safely update text content
        const iconElement = toggleBtn.querySelector(".material-icons");
        if (iconElement) {
            iconElement.textContent = "close_menu";
        }
    };
    const handleResize = () => {
        if (window.innerWidth > 900) {
            // For screens larger than 900px, keep the gallery open and disable toggle
            galleryContainer.style.left = "0";
        } else {
            // For screens 900px or smaller, enable toggle functionality
            closeGallery(); // Start in the closed state
        }
    };
    toggleBtn.addEventListener("click", (event) => {
        event.stopPropagation();
        if (window.innerWidth <= 900) { // Ensure toggle works only for smaller screens
            if (galleryContainer.style.left === "0px" || galleryContainer.style.left === "0") {
                closeGallery();
            } else {
                openGallery();
            }
        }
    });
    document.body.addEventListener("click", (event) => {
        if (window.innerWidth <= 900 && (galleryContainer.style.left === "0px" || galleryContainer.style.left === "0")) {
            closeGallery();
        }
    });
    // Listen for screen resize
    window.addEventListener("resize", handleResize);
    // Initial check on page load
    handleResize();
});
